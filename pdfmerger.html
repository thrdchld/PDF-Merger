<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Bulk Merger</title>
    
    <!-- 
      === IMPORT LIBRARY EKSTERNAL (CDN) ===
      Aplikasi ini berjalan tanpa build tools (seperti Webpack/Vite), jadi kita memanggil library langsung dari CDN.
    -->

    <!-- Tailwind CSS: Framework CSS untuk styling cepat menggunakan class utility -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM: Library utama untuk membangun antarmuka pengguna (UI) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel: Compiler untuk mengubah kode JSX (React) menjadi JavaScript standar browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- PDF-Lib: Library inti untuk memanipulasi (merge, create, modify) file PDF di browser -->
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    
    <!-- JSZip: Library untuk membuat file .zip (digunakan saat "Download Semua") -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        /* Styling tambahan yang sulit dilakukan hanya dengan utility class Tailwind */
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background-color: #cbd5e1;
          border-radius: 20px;
        }
        /* Menampilkan kursor loading saat proses berat */
        .cursor-wait {
            cursor: wait;
        }
        /* Logika hover untuk Tooltip custom */
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
    
    <!-- Wadah (Container) tempat React akan me-render aplikasi -->
    <div id="root"></div>

    <!-- Script Utama Aplikasi (type="text/babel" agar bisa membaca JSX) -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // =================================================================
        // BAGIAN 1: KOMPONEN UI PENDUKUNG (IKON & TOOLTIP)
        // Kita membuat komponen ikon sendiri (SVG) agar tidak bergantung 
        // pada library ikon eksternal yang sering error di lingkungan tanpa build tool.
        // =================================================================

        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        // Definisi berbagai ikon yang digunakan di aplikasi
        const Plus = (props) => <IconBase {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></IconBase>;
        const GripVertical = (props) => <IconBase {...props}><circle cx="9" cy="12" r="1"></circle><circle cx="9" cy="5" r="1"></circle><circle cx="9" cy="19" r="1"></circle><circle cx="15" cy="12" r="1"></circle><circle cx="15" cy="5" r="1"></circle><circle cx="15" cy="19" r="1"></circle></IconBase>;
        const Download = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></IconBase>;
        const X = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconBase>;
        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></IconBase>;
        const FilePlus = (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></IconBase>;
        const Info = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></IconBase>;
        const Eye = (props) => <IconBase {...props}><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></IconBase>;
        const Archive = (props) => <IconBase {...props}><polyline points="21 8 21 21 3 21 3 8"></polyline><rect x="1" y="3" width="22" height="5"></rect><line x1="10" y1="12" x2="14" y2="12"></line></IconBase>;

        // Wrapper Tooltip: Menampilkan teks bantuan saat elemen di-hover
        const Tooltip = ({ text, children, className = "" }) => (
            <div className={`tooltip-container relative flex items-center ${className}`}>
                {children}
                <div className="tooltip-text invisible opacity-0 absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-800 text-white text-xs rounded shadow-lg transition-all whitespace-nowrap z-50 pointer-events-none">
                    {text}
                    {/* Panah kecil tooltip */}
                    <div className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800"></div>
                </div>
            </div>
        );

        // =================================================================
        // BAGIAN 2: LOGIKA UTAMA APLIKASI (COMPONENT APP)
        // =================================================================
        function App() {
            // --- STATE MANAGEMENT ---
            
            // 1. Status Library: Memastikan PDF-Lib sudah siap sebelum dipanggil
            const [isPDFLibLoaded, setIsPDFLibLoaded] = useState(false);
            // 2. Status Zip: Loading indicator saat proses download semua
            const [isZipping, setIsZipping] = useState(false);

            // useEffect ini berjalan sekali saat aplikasi dimulai untuk mengecek library
            useEffect(() => {
                const checkLib = () => {
                    if (window.PDFLib) {
                        setIsPDFLibLoaded(true);
                    }
                };
                
                checkLib();
                // Cek ulang setiap 500ms jika koneksi lambat
                const interval = setInterval(checkLib, 500);
                return () => clearInterval(interval);
            }, []);

            // 3. Main Data: Menyimpan array 'jobs'. Setiap 'job' adalah satu kotak merge.
            const [jobs, setJobs] = useState([
                {
                    id: 1,
                    nameMode: 'custom', // Pilihan nama output: 'custom' atau ID file input
                    customName: 'Dokumen Gabungan 1',
                    status: 'idle', // Status proses: 'idle', 'processing', 'success', 'error'
                    dragOver: false, // State visual saat user men-drag file dari luar browser
                    files: [] // Array file PDF yang ada di dalam kotak ini
                }
            ]);
            
            // 4. Drag & Drop Sorting State (Internal): Mengatur pemindahan posisi file
            const [draggedItem, setDraggedItem] = useState(null); // Item yang sedang dipegang
            const [draggedOverItem, setDraggedOverItem] = useState(null); // Item yang ditimpa/dituju
            const [draggedFromJob, setDraggedFromJob] = useState(null); // Asal kotak item

            // --- FUNGSI MANAJEMEN JOBS (CRUD KOTAK) ---

            // Menambah kotak proyek baru
            const addJob = () => {
                const newId = Math.max(...jobs.map(j => j.id), 0) + 1;
                setJobs([...jobs, {
                    id: newId,
                    nameMode: 'custom',
                    customName: `Dokumen Gabungan ${newId}`,
                    status: 'idle',
                    dragOver: false,
                    files: []
                }]);
            };

            // Menghapus kotak proyek
            const removeJob = (jobId) => {
                setJobs(jobs.filter(j => j.id !== jobId));
            };

            // Fungsi generik untuk mengubah data di dalam job tertentu (misal ganti nama, status, dll)
            const updateJob = (jobId, field, value) => {
                setJobs(jobs.map(j => j.id === jobId ? { ...j, [field]: value } : j));
            };

            // --- FUNGSI MANAJEMEN FILE (UPLOAD & INPUT) ---

            // Helper untuk memformat objek file agar seragam
            const processFiles = (fileList) => {
                return Array.from(fileList)
                    .filter(file => file.type === 'application/pdf') // Validasi: Hanya terima PDF
                    .map(file => ({
                        id: Math.random().toString(36).substr(2, 9), // ID unik acak
                        file: file, // Objek File asli (Blob)
                        name: file.name,
                        size: (file.size / 1024 / 1024).toFixed(2) + ' MB' // Konversi size ke MB
                    }));
            };

            // Menangani input file baik dari tombol (+) maupun Drop event
            const handleFileUpload = (jobId, eventOrFiles) => {
                let filesToAdd = [];
                
                // Skenario 1: Dari Input Element (<input type="file">)
                if (eventOrFiles.target && eventOrFiles.target.files) {
                    filesToAdd = processFiles(eventOrFiles.target.files);
                    eventOrFiles.target.value = null; // Reset agar bisa pilih file yang sama lagi
                } 
                // Skenario 2: Dari Drag & Drop langsung (FileList)
                else if (eventOrFiles.length !== undefined) {
                    filesToAdd = processFiles(eventOrFiles);
                }

                if (filesToAdd.length === 0) return;

                // Update state jobs dengan file baru
                setJobs(prevJobs => prevJobs.map(job => {
                    if (job.id === jobId) {
                        return { 
                            ...job, 
                            files: [...job.files, ...filesToAdd],
                            dragOver: false // Matikan efek visual dragOver
                        };
                    }
                    return job;
                }));
            };

            // --- LOGIKA DRAG & DROP EXTERNAL (OS KE BROWSER) ---

            // Saat file ditarik di atas kotak
            const handleBoxDragOver = (e, jobId) => {
                e.preventDefault();
                // Cek apakah yang ditarik adalah file
                if (e.dataTransfer.types.includes('Files')) {
                    updateJob(jobId, 'dragOver', true); // Nyalakan border putus-putus biru
                }
            };

            // Saat file ditarik keluar dari kotak tanpa dilepas
            const handleBoxDragLeave = (e, jobId) => {
                e.preventDefault();
                updateJob(jobId, 'dragOver', false);
            };

            // Saat file dilepas (di-drop) ke dalam kotak
            const handleBoxDrop = (e, jobId) => {
                e.preventDefault();
                if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                    // Proses file yang didrop
                    handleFileUpload(jobId, e.dataTransfer.files);
                } else {
                    updateJob(jobId, 'dragOver', false);
                }
            };

            // --- FUNGSI UTILITAS FILE (HAPUS & PREVIEW) ---

            const removeFile = (jobId, fileId) => {
                setJobs(prevJobs => prevJobs.map(job => {
                    if (job.id === jobId) {
                        // Jika file yang dihapus sedang dipakai sebagai nama output, kembalikan mode ke 'custom'
                        const isSelectedName = job.nameMode === fileId;
                        return { 
                            ...job, 
                            nameMode: isSelectedName ? 'custom' : job.nameMode,
                            files: job.files.filter(f => f.id !== fileId) 
                        };
                    }
                    return job;
                }));
            };

            // Membuka PDF di tab baru menggunakan Blob URL browser
            const previewFile = (file) => {
                const url = URL.createObjectURL(file);
                window.open(url, '_blank');
            };

            // --- LOGIKA DRAG & DROP INTERNAL (SORTING URUTAN MERGE) ---

            const handleDragStart = (e, jobId, index) => {
                setDraggedItem(index);
                setDraggedFromJob(jobId);
                e.dataTransfer.effectAllowed = "move";
                e.stopPropagation(); // Mencegah konflik dengan event drag box parent
            };

            const handleDragEnter = (e, index) => {
                setDraggedOverItem(index);
            };

            // Logika menukar posisi array saat drop selesai
            const handleDragEnd = (jobId) => {
                if (draggedFromJob === jobId && draggedItem !== null && draggedOverItem !== null) {
                    const jobIndex = jobs.findIndex(j => j.id === jobId);
                    const newJobs = [...jobs];
                    const jobFiles = [...newJobs[jobIndex].files];
                    
                    // Tukar posisi file
                    const itemToMove = jobFiles[draggedItem];
                    jobFiles.splice(draggedItem, 1);
                    jobFiles.splice(draggedOverItem, 0, itemToMove);
                    
                    newJobs[jobIndex].files = jobFiles;
                    setJobs(newJobs);
                }
                // Reset state drag
                setDraggedItem(null);
                setDraggedOverItem(null);
                setDraggedFromJob(null);
            };

            // --- LOGIKA PENGGABUNGAN (MERGE CORE) ---

            // Menentukan nama file akhir berdasarkan pilihan user
            const getFinalFileName = (job) => {
                let finalName = job.customName;
                // Jika user memilih salah satu file input sebagai nama
                if (job.nameMode !== 'custom') {
                    const selectedFile = job.files.find(f => f.id === job.nameMode);
                    if (selectedFile) {
                        finalName = selectedFile.name.replace(/\.pdf$/i, ''); // Hapus ekstensi lama
                    }
                }
                // Sanitasi nama file (hapus karakter aneh)
                finalName = finalName.replace(/[^a-z0-9 \-_]/gi, '_'); 
                // Pastikan akhiran .pdf
                if (!finalName.toLowerCase().endsWith('.pdf')) finalName += '.pdf';
                return finalName;
            }

            // Fungsi Inti: Menggabungkan PDF menjadi Bytes menggunakan PDF-Lib
            const generateMergedPdfBytes = async (job) => {
                const { PDFDocument } = window.PDFLib;
                // Buat dokumen PDF kosong baru
                const mergedPdf = await PDFDocument.create();

                // Loop setiap file input
                for (const fileObj of job.files) {
                    const fileBuffer = await fileObj.file.arrayBuffer();
                    // Load PDF input
                    const pdf = await PDFDocument.load(fileBuffer);
                    // Salin semua halaman dari PDF input ke PDF baru
                    const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    copiedPages.forEach((page) => mergedPdf.addPage(page));
                }

                // Simpan hasil sebagai Uint8Array
                return await mergedPdf.save();
            }

            // --- HANDLER TOMBOL MERGE (SATUAN) ---
            const mergeSinglePDF = async (job) => {
                if (!isPDFLibLoaded) {
                    alert("Library PDF sedang dimuat, mohon tunggu sebentar...");
                    return;
                }
                if (job.files.length < 1) return;

                updateJob(job.id, 'status', 'processing');

                try {
                    // 1. Generate Bytes
                    const pdfBytes = await generateMergedPdfBytes(job);
                    const finalName = getFinalFileName(job);

                    // 2. Trigger Download via Blob Link
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = finalName;
                    link.click();

                    updateJob(job.id, 'status', 'success');
                    setTimeout(() => updateJob(job.id, 'status', 'idle'), 3000);

                } catch (error) {
                    console.error("Merge Error:", error);
                    alert("Gagal menggabungkan PDF. Pastikan file tidak rusak.");
                    updateJob(job.id, 'status', 'error');
                }
            };

            // --- HANDLER TOMBOL DOWNLOAD SEMUA (ZIP) ---
            const mergeAllAndZip = async () => {
                if (!isPDFLibLoaded) return;
                
                // Cari job yang valid (minimal 2 file)
                const validJobs = jobs.filter(j => j.files.length >= 2);
                if (validJobs.length === 0) {
                    alert("Tidak ada proyek yang siap digabung (minimal 2 file per kotak).");
                    return;
                }

                setIsZipping(true);
                const zip = new JSZip(); // Inisialisasi JSZip
                
                const setStatus = (id, status) => {
                     setJobs(prev => prev.map(j => j.id === id ? { ...j, status: status } : j));
                };

                try {
                    let processedCount = 0;
                    
                    // Proses setiap job satu per satu
                    for (const job of validJobs) {
                        setStatus(job.id, 'processing');
                        try {
                            const pdfBytes = await generateMergedPdfBytes(job);
                            const fileName = getFinalFileName(job);
                            
                            // Tambahkan file PDF hasil merge ke dalam object ZIP
                            zip.file(fileName, pdfBytes);
                            
                            setStatus(job.id, 'success');
                            processedCount++;
                        } catch (err) {
                            console.error(`Error processing job ${job.id}`, err);
                            setStatus(job.id, 'error');
                        }
                    }

                    if (processedCount > 0) {
                        // Generate file .zip final dan trigger download
                        const content = await zip.generateAsync({type: "blob"});
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(content);
                        link.download = "all_merged_pdfs.zip";
                        link.click();
                    } else {
                        alert("Gagal memproses semua file.");
                    }

                } catch (error) {
                    console.error("Zip Error:", error);
                    alert("Terjadi kesalahan saat membuat ZIP.");
                } finally {
                    setIsZipping(false);
                    // Reset status indikator setelah selesai
                    setTimeout(() => {
                        setJobs(prev => prev.map(j => j.status === 'success' || j.status === 'processing' ? { ...j, status: 'idle' } : j));
                    }, 3000);
                }
            };

            // =================================================================
            // BAGIAN 3: RENDER TAMPILAN (JSX)
            // =================================================================
            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 font-sans p-4 md:p-8 relative pb-24">
                
                {/* Header Bagian Atas */}
                <header className="max-w-7xl mx-auto mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div>
                    <h1 className="text-3xl font-bold text-slate-900 flex items-center gap-2">
                        <span className="bg-blue-600 text-white p-2 rounded-lg">
                        <FileText size={24} />
                        </span>
                        PDF Bulk Merger
                    </h1>
                    <p className="text-slate-500 mt-1">Gabungkan banyak dokumen dalam batch sekaligus.</p>
                    </div>
                </header>

                {/* Grid Container untuk Kotak-Kotak Proyek */}
                <div className="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    
                    {jobs.map((job) => (
                    <div 
                        key={job.id} 
                        // Event listener untuk Drag & Drop External (Upload)
                        onDragOver={(e) => handleBoxDragOver(e, job.id)}
                        onDragLeave={(e) => handleBoxDragLeave(e, job.id)}
                        onDrop={(e) => handleBoxDrop(e, job.id)}
                        className={`
                            rounded-2xl shadow-sm border flex flex-col h-[500px] transition-all hover:shadow-md
                            ${job.dragOver ? 'border-2 border-dashed border-blue-500 bg-blue-50' : 'bg-white border-slate-200'}
                        `}
                    >
                        {/* Overlay Visual saat file di-drag di atas kotak */}
                        {job.dragOver && (
                            <div className="absolute inset-0 z-50 flex items-center justify-center bg-blue-100/50 rounded-2xl pointer-events-none">
                                <div className="bg-white p-4 rounded-full shadow-lg text-blue-600 animate-bounce">
                                    <FilePlus size={32} />
                                </div>
                            </div>
                        )}

                        {/* Bagian Header Kotak (Input Nama & Tombol Hapus) */}
                        <div className="p-4 border-b border-slate-100 flex justify-between items-start bg-slate-50/50 rounded-t-2xl relative">
                        <div className="flex-1 mr-2">
                            <div className="flex items-center gap-1 mb-1">
                                <label className="text-xs font-semibold text-slate-400 uppercase tracking-wider block">
                                    Nama Output
                                </label>
                                <Tooltip text="Pilih nama file hasil gabungan">
                                    <Info size={12} className="text-slate-400 cursor-help" />
                                </Tooltip>
                            </div>

                            {/* Dropdown Pilihan Nama */}
                            <div className="flex gap-2 mb-2">
                            <select 
                                className="bg-white border border-slate-300 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2"
                                value={job.nameMode}
                                onChange={(e) => updateJob(job.id, 'nameMode', e.target.value)}
                            >
                                <option value="custom">Ketik Sendiri (Custom)</option>
                                {/* Menampilkan opsi nama file dari file yang diupload */}
                                {job.files.length > 0 && (
                                    <optgroup label="Pilih dari file input:">
                                        {job.files.map(f => (
                                            <option key={f.id} value={f.id}>{f.name}</option>
                                        ))}
                                    </optgroup>
                                )}
                            </select>
                            </div>
                            
                            {/* Input Teks Manual (hanya muncul jika mode custom) */}
                            {job.nameMode === 'custom' && (
                            <input 
                                type="text" 
                                value={job.customName}
                                onChange={(e) => updateJob(job.id, 'customName', e.target.value)}
                                className="w-full text-sm font-medium bg-white border border-slate-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500 transition-colors"
                                placeholder="Masukkan nama file..."
                            />
                            )}
                        </div>
                        <Tooltip text="Hapus Proyek Ini">
                            <button 
                                onClick={() => removeJob(job.id)}
                                className="text-slate-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg transition-colors"
                            >
                                <X size={20} />
                            </button>
                        </Tooltip>
                        </div>

                        {/* Area Daftar File (Bisa di-scroll) */}
                        <div className="flex-1 overflow-y-auto p-4 custom-scrollbar bg-slate-50/30 relative">
                        {job.files.length === 0 ? (
                            // Tampilan jika belum ada file (Placeholder)
                            <div className="h-full flex flex-col items-center justify-center text-slate-400 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50 pointer-events-none">
                            <FilePlus size={48} className="mb-2 opacity-50" />
                            <p className="text-sm font-medium">Drag PDF kesini</p>
                            <p className="text-xs">atau gunakan tombol + dibawah</p>
                            </div>
                        ) : (
                            // Daftar item file
                            <div className="space-y-2">
                            {job.files.map((file, index) => (
                                <div 
                                key={file.id}
                                // Atribut untuk Drag & Drop Internal (Sorting)
                                draggable
                                onDragStart={(e) => handleDragStart(e, job.id, index)}
                                onDragEnter={(e) => handleDragEnter(e, index)}
                                onDragEnd={() => handleDragEnd(job.id)}
                                onDragOver={(e) => e.preventDefault()}
                                className={`
                                    relative group flex items-center gap-2 p-3 bg-white rounded-xl border transition-all cursor-grab active:cursor-grabbing
                                    ${draggedItem === index && draggedFromJob === job.id ? 'opacity-40 border-dashed border-blue-400' : 'border-slate-200 hover:border-blue-300 shadow-sm'}
                                `}
                                >
                                {/* Handle Grip untuk menggeser */}
                                <div className="text-slate-300 cursor-grab flex-shrink-0" title="Geser untuk mengubah urutan">
                                    <GripVertical size={16} />
                                </div>
                                <div className="bg-red-50 text-red-500 p-2 rounded-lg flex-shrink-0">
                                    <FileText size={18} />
                                </div>
                                <div className="flex-1 min-w-0" title={file.name}> 
                                    <p className="text-sm font-medium text-slate-700 truncate cursor-help">{file.name}</p>
                                    <p className="text-xs text-slate-400">{file.size}</p>
                                </div>
                                
                                {/* Tombol Aksi Item (Preview & Hapus) */}
                                <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <Tooltip text="Preview File">
                                        <button 
                                            onClick={() => previewFile(file.file)}
                                            className="p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all"
                                        >
                                            <Eye size={16} />
                                        </button>
                                    </Tooltip>
                                    <Tooltip text="Hapus file ini">
                                        <button 
                                            onClick={() => removeFile(job.id, file.id)}
                                            className="p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all"
                                        >
                                            <Trash2 size={16} />
                                        </button>
                                    </Tooltip>
                                </div>
                                </div>
                            ))}
                            </div>
                        )}
                        </div>

                        {/* Footer Kotak (Tombol Upload & Merge) */}
                        <div className="p-4 border-t border-slate-100 bg-white rounded-b-2xl">
                        <div className="flex gap-2">
                            {/* Tombol Upload (Input File tersembunyi) */}
                            <label className="flex-1 cursor-pointer bg-slate-100 hover:bg-slate-200 text-slate-600 py-2.5 px-4 rounded-xl text-sm font-medium text-center transition-colors flex items-center justify-center gap-2 group" title="Upload file PDF">
                                <Plus size={16} />
                                Tambah PDF
                                <input 
                                    type="file" 
                                    multiple 
                                    accept="application/pdf"
                                    className="hidden" 
                                    onChange={(e) => handleFileUpload(job.id, e)}
                                />
                            </label>
                            
                            {/* Tombol Merge (Eksekusi) */}
                            <Tooltip text={job.files.length < 2 ? "Upload minimal 2 file" : "Gabungkan file sekarang"} className="flex-1">
                                <button 
                                onClick={() => mergeSinglePDF(job)}
                                disabled={job.files.length < 2 || job.status === 'processing'}
                                className={`
                                    w-full py-2.5 px-4 rounded-xl text-sm font-medium text-center flex items-center justify-center gap-2 text-white transition-all
                                    ${job.status === 'processing' ? 'bg-blue-400 cursor-wait' : 
                                    job.status === 'success' ? 'bg-green-500' :
                                    job.status === 'error' ? 'bg-red-500' :
                                    job.files.length < 2 ? 'bg-slate-300 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-200'}
                                `}
                                >
                                {/* Feedback Visual berdasarkan status */}
                                {job.status === 'processing' ? (
                                    <>Memproses...</>
                                ) : job.status === 'success' ? (
                                    <><CheckCircle size={16} /> Selesai</>
                                ) : job.status === 'error' ? (
                                    <><AlertCircle size={16} /> Error</>
                                ) : (
                                    <><Download size={16} /> Gabung PDF</>
                                )}
                                </button>
                            </Tooltip>
                        </div>
                        </div>

                    </div>
                    ))}
                    
                    {/* Kartu Khusus untuk Menambah Kotak Baru */}
                    <button 
                        onClick={addJob}
                        className="h-[500px] border-2 border-dashed border-slate-300 rounded-2xl flex flex-col items-center justify-center text-slate-400 hover:border-blue-500 hover:text-blue-500 hover:bg-blue-50/50 transition-all cursor-pointer group bg-slate-100/50"
                        title="Klik untuk membuat proyek baru"
                    >
                        <div className="bg-white p-4 rounded-full shadow-sm mb-4 group-hover:scale-110 transition-transform">
                            <Plus size={32} />
                        </div>
                        <span className="font-medium text-lg">Tambah Kotak Merge</span>
                    </button>

                </div>

                {/* Floating Action Button (FAB) di pojok kanan bawah untuk Download Semua */}
                <div className="fixed bottom-8 right-8 z-50">
                     <button
                        onClick={mergeAllAndZip}
                        disabled={isZipping || jobs.every(j => j.files.length < 2)}
                        className={`
                            flex items-center gap-3 px-6 py-4 rounded-full shadow-2xl transition-all transform hover:scale-105 active:scale-95
                            ${isZipping ? 'bg-slate-700 cursor-wait' : 
                              jobs.every(j => j.files.length < 2) ? 'bg-slate-400 cursor-not-allowed' : 'bg-slate-900 hover:bg-slate-800'} 
                            text-white font-bold text-lg
                        `}
                     >
                        {isZipping ? (
                            <>
                                <span className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></span>
                                Memproses Zip...
                            </>
                        ) : (
                            <>
                                <Archive size={24} />
                                Download Semua (.zip)
                            </>
                        )}
                     </button>
                </div>

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>